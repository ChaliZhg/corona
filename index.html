<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Realtime coronavirus cases in Germany</title>


<style type="text/css">
body {margin: 0;padding: 0;text-align: center;background: #FFFFFF;}
#convas {
 width: 100%; /* 这将创建一个占据 80% 浏览器宽度的容器 */
 background: #FFFFFF;
 margin: 0 auto; /* 自动边距（与宽度一起）会将页面居中 */
 border: 0px solid #000000;
 text-align: left; /* 这将覆盖 body 元素上的“text-align: center”。 */
}
</style>


</head>
<body>
<script src="d3.min.js"></script>
<script src="topojson.min.js"></script>
    <script src="datamaps.deu.js"></script>
    <h1 id='message'></h1>
    <div id='source'>According to realtime data from zeit.de</div>
    <div id='time'></div>
    <div id="convas" style="height: 600px; width: 600px;"></div>
    <script>
    bubbles = [];
    total = 0;
    atSachsen = 0;
    scale = 3;

d3.csv("https://interactive.zeit.de/cronjobs/2020/corona/bundeslaender.csv", function(data){
    for (var i = data.length - 1; i >= 0; i--) {
        if(data[i].Bundesland.length>0)
        {
            if(data[i].Bundesland=="Summe")
            {
                total = data[i].Fälle
            }
            else
            {
                anode = 
                {
                    centered: data[i].Bundesland,
                    fillKey: "high",
                    radius: Math.sqrt(data[i].Fälle)*scale,
                    value:data[i].Fälle
                };
                bubbles.push(anode);
            }
            if(data[i].Bundesland=="Sachsen")
            {atSachsen = data[i].Fälle}
        }
    };
        document.getElementById('message').innerHTML = 
        total + " confirmed cases in Germany with "+atSachsen+" at Sachsen.";
        var dt = new Date();
        document.getElementById('time').innerHTML = 
        dt.toString();
});
    var bubble_map = new Datamap({
        element: document.getElementById('convas'),
        scope: 'deu',
        responsive: true,
        geographyConfig: {
            popupOnHover: true,
            highlightOnHover: true,
            borderColor: '#444',
            borderWidth: 0.5,
        },
    fills: {
    defaultFill: "#dddddd",
    high: 'red',
    middle: '#80ffe5',
    low: '#0f00fa'
    },
    data: {
    'Sachsen': { fillKey: 'middle' },
    },
    setProjection: function (element) {
        var projection = d3.geo.mercator()
            .center([14.5, 52]) // always in [East Latitude, North Longitude]
            .scale(2500);
        var path = d3.geo.path().projection(projection);
        return { path: path, projection: projection };
    }
    });


    bubble_map.labels();
    //ISO ID code for city or <state></state>
    setTimeout(() => { // only start drawing bubbles on the map when map has rendered completely.
        bubble_map.bubbles(bubbles, {
            popupTemplate: function (geo, data) {
                return `<div class="hoverinfo">${data.centered}: ${data.value}</div>`;
            }
        });
    }, 1000);

    window.addEventListener('resize', function() {
        window.bubble_map.resize();
    });

    </script>
</body>

</html>
